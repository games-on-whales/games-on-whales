<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Games On Whales</title>
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="stylesheet" href="../_/css/site-extra.css">    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
    <div class="fancy-stripe"></div>
    <nav class="navbar">
        <div class="navbar-brand">
            <a class="navbar-item" href="..">Games On Whales</a>
                <div class="navbar-item search hide-for-print">
                    <div id="search-field" class="field">
                        <input id="search-input" type="text" placeholder="Search the docs">
                    </div>
                </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link" href="#">Projects</a>
                    <div class="navbar-dropdown">
                        <a class="navbar-item" href="https://games-on-whales.github.io/gow/">Games on Whales</a>
                        <a class="navbar-item" href="https://games-on-whales.github.io/wolf">Wolf</a>
                    </div>
                </div>
                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link" href="#">Community</a>
                    <div class="navbar-dropdown">
                        <a class="navbar-item" href="https://discord.gg/kRGUDHNHt2">Discord</a>
                        <a class="navbar-item" href="https://github.com/games-on-whales">Github</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>
<div class="body">
<div class="nav-container" data-component="gow" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">gow</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Home</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">What is GOW?</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="components-overview.html">Components</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="how-to-use.html">How can I use GOW?</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="roadmap.html">Roadmap</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="headless.html">Headless</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="debian-headless.html">Debian/Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="headless-unraid.html">Unraid</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="raspberry-headless.html">Raspberry</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="kubernetes.html">Kubernetes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="desktop.html">Desktop</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="debian-desktop.html">Debian/Ubuntu</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="windows.html">Windows</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="steam.html">Steam</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="nvidia.html">Nvidia GPU</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Contributing/Developing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="contributing.html">Contributing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="docker-build.html">Docker build</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">gow</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">gow</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../wolf/index.html">wolf</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../wolf/index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">gow</a></li>
    <li><a href="index.html">Home</a></li>
    <li>Configuration</li>
    <li><a href="nvidia.html">Nvidia GPU</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/games-on-whales/gow/edit/master/docs/modules/ROOT/pages/nvidia.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_nvidia_hw_acceleration"><a class="anchor" href="#_nvidia_hw_acceleration"></a>Nvidia HW acceleration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_nvidia_gpus_with_nouveau_drivers"><a class="anchor" href="#_nvidia_gpus_with_nouveau_drivers"></a>Nvidia GPUs with <code>nouveau</code> drivers</h3>
<div class="paragraph">
<p>Make sure that the host doesn’t use proprietary drivers but that it’s
using the open source <code>nouveau</code> drivers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo lshw -class video | grep driver=
       configuration: driver=nouveau latency=0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Double check that the GPU card is correctly listed under <code>/dev/dri/</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ls -la /dev/dri/
total 0
drwxr-xr-x  3 root root        100 Jun 20 09:47 .
drwxr-xr-x 17 root root       3100 Jun 20 10:33 ..
drwxr-xr-x  2 root root         80 Jun 20 09:47 by-path
crw-rw----  1 root video  226,   0 Jun 20 09:47 card0
crw-rw----  1 root render 226, 128 Jun 20 09:47 renderD128</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nvidia_gpus_with_proprietary_drivers"><a class="anchor" href="#_nvidia_gpus_with_proprietary_drivers"></a>Nvidia GPUs with proprietary drivers</h3>
<div class="paragraph">
<p>You can see if your host is using the proprietary driver using <code>lshw</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ lshw -class video | grep -i driver
       configuration: driver=nvidia latency=0</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to make use of your GPU inside a docker container, you’ll need
to set up the <a href="https://github.com/NVIDIA/nvidia-docker">NVIDIA Container
Toolkit</a>.</p>
</div>
<div class="paragraph">
<p>Once that’s done, you can run the container. You should add the
following ENV variables to the docker-compose file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">environment:
    NVIDIA_VISIBLE_DEVICES: GPU-[uuid] # Replace [uuid] (see the instructions)
    NVIDIA_DRIVER_CAPABILITIES: utility,graphics,video,display</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the correct UUID for your GPU, use the <code>nvidia-container-cli</code>
command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sudo nvidia-container-cli --load-kmods info
NVRM version:   [version]
CUDA version:   11.3

Device Index:   0
Device Minor:   0
Model:          NVIDIA GeForce [model]
Brand:          GeForce
GPU UUID:       GPU-[uuid]
Bus Location:   00000000:0a:00.0
Architecture:   7.5</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_xorg_drivers"><a class="anchor" href="#_xorg_drivers"></a>Xorg drivers</h4>
<div class="paragraph">
<p>Although the NVIDIA Container Toolkit automatically provides most of the
drivers needed to use the GPU inside a container, Xorg is <em>not</em>
officially supported. This means that the runtime will not automatically
map in the specific drivers needed by Xorg.</p>
</div>
<div class="paragraph">
<p>There are two libraries needed by Xorg: <code>nvidia_drv.so</code> and
<code>libglxserver_nvidia.so.[version]</code>. It is preferred to map these into
the container as a bind volume from the host, because this guarantees
that the version will exactly match between the container and the host.
Locate the two modules and add a section like this to the <code>xorg</code> service
in your <code>docker-compose.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">volumes:
  - /path/to/nvidia_drv.so:/nvidia/xorg/nvidia_drv.so:ro
  - /path/to/libglxserver_nvidia.so.[version]:/nvidia/xorg/libglxserver_nvidia.so:ro</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to replace <code>[version]</code> with the correct version number from the
<code>nvidia-container-cli</code> command above.</p>
</div>
<div class="paragraph">
<p>Some common locations for <code>nvidia_drv.so</code> include: *
<code>/usr/lib64/xorg/modules/drivers/</code> (Unraid) *
<code>/usr/lib/x86_64-linux-gnu/nvidia/xorg/</code> (Ubuntu 20.04)</p>
</div>
<div class="paragraph">
<p>Some common locations for <code>libglxserver_nvidia.so.[version]</code> include: *
<code>/usr/lib64/xorg/modules/extensions/</code> (Unraid) *
<code>/usr/lib/x86_64-linux-gnu/nvidia/xorg/</code> (Ubuntu 20.04)</p>
</div>
<div class="paragraph">
<p>If you don’t want to do this, or if you can’t find the driver on your
host for some reason, the container will attempt to install the correct
version for you automatically. However, there is no guarantee that it
will be able to find a version that exactly matches the driver version
on your host.</p>
</div>
<div class="paragraph">
<p>If for some reason you want to skip the entire process and just assume
the driver is already installed, you can do that too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">environment:
    SKIP_NVIDIA_DRIVER_CHECK: 1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <p>Copyright &#169; Alessandro Beltramo and <a href="https://github.com/games-on-whales">GOW</a> contributors.</p>
    <p>Except where otherwise noted, docs are licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a> (CC BY-SA 4.0).</p>
</footer><script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
